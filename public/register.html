<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Реєстрація користувача — Демо №2</title>
<style>
  :root{
    --bg: #0b0f1a;
    --card-bg: rgba(255,255,255,0.03);
    --neon1: #7df9ff;
    --neon2: #ff6bcb;
    --accent: linear-gradient(90deg,var(--neon1),var(--neon2));
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;background:var(--bg);color:#e6eef6;overflow-x:hidden}
  .wrap{min-height:100vh;display:flex;flex-direction:column;align-items:center;gap:40px;padding:60px 20px;margin-left:60px;}

  header{text-align:center;margin-top:10px}
  h1{font-size:2rem;margin:0 0 6px 0;letter-spacing:0.6px}
  p.lead{margin:0;color:rgba(230,238,246,0.75)}

  .register-card {
    background: var(--card-bg);
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.5);
    display:flex;
    flex-direction: column;
    gap: 10px;
    width:100%;
    max-width:320px;
    color:#fff;
  }
  .register-card input {
    padding:8px 10px;
    border-radius:6px;
    border:none;
    outline:none;
    background:rgba(255,255,255,0.1);
    color:#fff;
    font-size:0.95rem;
  }
  .register-card button {
    padding:10px;
    border-radius:8px;
    border:none;
    cursor:pointer;
    background:linear-gradient(90deg,var(--neon1),var(--neon2));
    color:#000;
    font-weight:600;
    font-size:0.95rem;
    transition: transform .15s;
  }
  .register-card button:hover {transform:translateY(-2px);}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Реєстрація користувача</h1>
      <p class="lead">Введіть email та пароль</p>
    </header>

    <section class="register-card">
      <input type="email" id="emailField" placeholder="Електронна пошта" required>
      <input type="password" id="passwordField" placeholder="Пароль" required>
      <button id="registerBtn">Зареєструватися</button>
      <p id="statusMessage" style="color:#ffcccb;margin-top:5px;font-size:0.9rem;"></p>
    </section>
  </div>

<script>
  const registerBtn = document.getElementById("registerBtn");
  const statusMessage = document.getElementById("statusMessage");

  function validateEmail(email) {
    // Перевірка формату email
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  }

  function validatePassword(password) {
    // Мінімум 8 символів, 1 велика, 1 мала, 1 цифра, 1 спеціальний символ
    const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
    return passwordRegex.test(password);
  }

  registerBtn.addEventListener("click", async e => {
    e.preventDefault();

    const email = document.getElementById("emailField").value.trim();
    const password = document.getElementById("passwordField").value.trim();

    // --- Перевірка перед відправкою ---
    if (!email || !password) {
      statusMessage.style.color = "#ff6b6b";
      statusMessage.textContent = "Заповніть обидва поля!";
      return;
    }

    if (!validateEmail(email)) {
      statusMessage.style.color = "#ff6b6b";
      statusMessage.textContent = "Введіть коректну електронну адресу.";
      return;
    }

    if (!validatePassword(password)) {
      statusMessage.style.color = "#ff6b6b";
      statusMessage.textContent = "Пароль має містити мінімум 8 символів, велику і малу літеру, цифру та спеціальний символ.";
      return;
    }

    // --- Якщо валідація пройшла, надсилаємо запит ---
    try {
      const res = await fetch("/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password })
      });

      if (res.redirected) {
        window.location.href = res.url;
      } else {
        const text = await res.text();
        statusMessage.style.color = "#ffcccb";
        statusMessage.textContent = text;
      }
    } catch (err) {
      statusMessage.style.color = "#ff6b6b";
      statusMessage.textContent = "Помилка: сервер недоступний.";
    }
  });
</script>
</body>
</html>
